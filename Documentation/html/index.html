<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ubie Sdk: Ubie Sdk</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Ubie Sdk
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Ubie Sdk </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This Document contains the developer documentation for the Ubie Sdk. The Sdk allows you to write applications, without a detailed knowledge of the Ubie internals, so you can focus on the actual application.</p>
<h2>1. Ubie</h2>
<p>Ubie is a device that connects different IOT devices in one platform. Utie is available as Ubie or UbiePro; Ubie runs on a small Arm SoC, UbiePro runs as a virtual machine on a server. The communication with the different IOT devices is done via Ubie Apps. This Sdk allows you to write such an app, to develop a bridge between Ubie and your own system via TCP/IP. More information regarding Ubie can be found on the <a href="https://www.ubiebox.com/en">UbieBox</a> website.</p>
<h2>2. UbieOS</h2>
<p>UbieOS is a collection of applications that offer services to the Ubie applications. The applications communicate with each other, and with the Ubie Apps. On top of these applications is the Watchdog: It is the first application that starts up. At startup, the watchdog will startup the other UbieOS applications, when this is complete it will startup all enabled Ubie applications.</p>
<p>If a application would stop working (ex. crash), then the watchdog will first try to stop it (in case it locked-up), and then it will restart the application.</p>
<div class="image">
<img src="UbieDiagram.png" alt="UbieDiagram.png"/>
<div class="caption">
Ubie</div></div>
<p>The Main application makes the connection with the UbieCloud, keeps a data logging, etc.. An application talks with both the WatchDog and the Main application. Applications never communicate directly with other appllications.</p>
<p>This SDK can be used to write applications like "App1" and "App2".</p>
<h2>3. Devices, Functionblocks</h2>
<p>A Ubie applications contains Devices and FunctionBlocks; they are the basic objects of a Ubie application. Each application can have one or more devices, and each device can have one or multiple functionblocks. A device is a equivalent to a hardware device; it is physically device, with an ip address. Each of these devices contain functionblocks. Functionblocks are the basic building blocks of the Ubie. They represent a logic function of a device (a light, switch, thermostat, etc...). Each functionblock has one or more "properties". They represent the dynamic state of a functionblock (is the light on, the room temperature, etc...). These properties can be read by the cloud, and can be changed by the cloud. Functionblocks can also have "actions". They represent certain actions that can be performed on the functionblock, without knowledge of the current state of a functionblock (ex. move a Shutter down, without knowing if the current position was up or down).</p>
<p>Example: </p><div class="image">
<img src="DevicesFunctionBlocks.png" alt="DevicesFunctionBlocks.png"/>
<div class="caption">
Devices And FunctionBlocks</div></div>
<h2>4. Static Configuration, Dynamic State</h2>
<p>All Ubie applications have a static configuration. The configuration of an applications are de devices, functionblocks. Functionblocks have properties, these properties have datatypes (bool, int, string, etc...). These can have min, max, read, write confiuration. All this combined is what we call configuration. The values of the properties is the state of the device and functionblock. It is the dynamic state of the application. When a property is changed, then this change is send to the Main application. This Main application will send the changed value to the Cloud. When a user clicks on a icon on the cloud to switch the light on, then this new property value is send to the Ubie, and the corresponding functionblock, where it triggers a callback function.</p>
<h2>5. UbieSimulator</h2>
<p>The UbieSimulator is a fully operational Ubie, compiled as a single application. It contains a visual representation of the static configuration of your application,as wel as a view on the dynamic state of functionblocks. It allows you to debug values send to the Cloud, and simulate new values received from the cloud. You need to request your own unique "keyfile". This file contains your serial number of the ubie, as wel as encryption keys to setup the communication with the (test) cloud.</p>
<div class="image">
<img src="Simulator.png" alt="Simulator.png"/>
<div class="caption">
Ubie Simulator</div></div>
 <h3>5.1 Leds</h3>
<p>The top left part of the screen contains the "Ubie Online" led, and send/receive leds, with the number of bytes that have been send/received by the Ubie. The treeview contains the current configuration of the Ubie App(s), as send to the Cloud. The color coding tells you what the last direction was of a property:</p>
<ul>
<li>Green: Initial value send to the cloud</li>
<li>Orange: Value from the cloud</li>
<li>Blue: Event from the Ubie</li>
</ul>
<h3>5.2 Sending properties</h3>
<p>The right part of the screen allows you to send property values and actions as if they where send from the cloud. Select a property in the treeview, and edit its value in "Property Edit". Then you can press "Send" to send it immediately, or "Add" to add it to the "Property OverView" list. When you press "Send" from "Property Overview" then you send the complete list of properties on one <code>commit()</code> call. When a new property value is send from the cloud to the Ubie, then this new property value should be processed by your application. Once you underlying system confirms the changed value, then this new value should be send to the cloud. Example:</p>
<ul>
<li>Cloud sends a new value for dimmer (set to 50%)</li>
<li>Your application receives this value</li>
<li>Your application translates this to you native format, and sends it to the device</li>
<li>Your devices responds (or via polling) that the new value was correctly set</li>
<li>You respond to the cloud that the value was set to 50%</li>
</ul>
<p>This behaviour can be seen in the "Property Overview" window. The column "Value" displays the value send to the cloud, the column "Received" contains the (if any) received value from the Ubie App.</p>
<h3>5.3 Watchdog</h3>
<p>The bottom left contains the Watchdog state. An application can be in the "Active" or "Failed" state. If your application is started, then it should always be in the "Active" state. If your application would fail to feed the watchdog, then the state would be "Failed"</p>
<h3>5.4 Statistics</h3>
<p>Next to the Watchdog overview, is the Statistics window. It allows you to see how much traffic your application generates.</p>
<h3>5.5 Configuration/State playback</h3>
<p>The "Config/State" window allows you to inspect every configuration/state event that was send to/from the cloud. When you select a "Configuration" then this configuration will be displayed in the treeview. When you select a Event/State row, then the treeview will display the corresponding configuration (last configuration before the state), and draw the selected state on the treeview (overlay)</p>
<h3>5.6 Cloud configuration</h3>
<p>Some applications require some aditional configuration from the cloud (ex IP address to use to communicate with your device). This window allows you to paste a json, as if it was send from the cloud. You will receive this configuration on the SdkClientIf as a call to <code>receivecloudConfig(const std::string&amp; config)</code></p>
<p>#6 Writing Code</p>
<p>A Ubie application is written in <a href="https://en.wikipedia.org/wiki/C%2B%2B11">C++ 11</a> , using <a href="http://www.cplusplus.com/reference/stl/">STL</a> / <a href="https://www.boost.org/">Boost</a> libraries as much as possible. When you executed the ubie_boootstrap script, then 3 projects where generated:</p>
<ul>
<li>The application library (AppLib)</li>
<li>The application test project (AppTest)</li>
<li>The application itself (App)</li>
</ul>
<p>The App project is nothing more than a container that instantiates your main application objects, and then waits for a exit signal. All your code should be located in the AppLib project. The AppLib project is linked to the App and AppTest project as a static library. The AppTest project is your unit testing project. It allows you to write unit tests for all your classes in the AppLib project. We use <a href="https://google.github.io/googletest/">Google Test and Mock</a> as testing framework. You can read an introduction to Google Test <a href="http://google.github.io/googletest/primer.html">http://google.github.io/googletest/primer.html</a></p>
<h2>7. Unit Testing</h2>
<p>A example unit testing project has been included in the Sdk. We strongly advise to write unit tests for all you code. Writing unit tests starts with the proper application architecture, that allows you to write unit tests. Do not write unit tests after you have written your application. Use unit testing to drive the application development (<a href="https://nl.wikipedia.org/wiki/Test-driven_development">Test driven development</a> ). Some interesting tips can be found <a href="http://blog.stevensanderson.com/2009/08/24/writing-great-unit-tests-best-and-worst-practises/">here.</a> All Sdk functionblocks have a gtest mock that can be used in unit tests. The header files can be found in the ./Mock subdirectory. More information regarding the usage of the mocks can be found in the gtest cheat sheet: <a href="https://google.github.io/googletest/gmock_cheat_sheet.html">https://google.github.io/googletest/gmock_cheat_sheet.html</a></p>
<h2>8. Build environment</h2>
<p>There are two build environments available:</p><ul>
<li>Visual Studio Code</li>
<li>CMake</li>
</ul>
<p>The environment in Visual Studio Code allows you to write te library code, and the unit tests. You can start the unit test by building the AppTest project, and then running the application from the ./bin/x86 folder.</p>
<p>The CMake build environment can be used to build the the application and unit tests in both x86 and arm (the native Ubie format) targets.</p>
<p>Then run the following command to update the cmake environment, and build the application in debug x86 configuration: <code>cd ~/build/Debug-x86/;cmake ../..;make</code></p>
<h2>9. Basic application</h2>
<p>When running the ubie_bootstrap script, you are asked to generate a Ubie Application. The code examples below, are based on the application name "Test". Your names may vary, if you used a different application name..</p>
<p>The first part of the aplication happens in the "App" project (see MainApp.cpp): </p><div class="fragment"><div class="line"><a class="code" href="classSdkNs_1_1UbieSdkIf.html">SdkNs::UbieSdkIf</a>* sdk = <a class="code" href="classSdkNs_1_1UbieFactory.html#af876ce7bfb540ce0856cd79f10aeba53">SdkNs::UbieFactory::createUbieSdk</a>(<span class="stringliteral">&quot;Test&quot;</span>, <span class="stringliteral">&quot;TST&quot;</span>);</div><div class="line"><span class="keyword">auto</span> TestMain =  TestNs::TestFactory::createTestMain(sdk);</div></div><!-- fragment --><p>The fist step is to create the sdk object. The factory constructor accepts two parameters:</p>
<ul>
<li>The application name. This name must be unique accross all ubie applications. You must register your app on the UbieCloud developers website; this will register the app name</li>
<li>Id prefix: This prefix must be unique accross all ubie applications. You will receive your id prefix when you register your application</li>
</ul>
<p>In the next step, you create your application object (TestNs::TestMainIf).</p>
<p>The constructor of SdkAppMain executes the following code (See AppLib project): </p><div class="fragment"><div class="line">TestMain::TestMain(<a class="code" href="classSdkNs_1_1UbieSdkIf.html">SdkNs::UbieSdkIf</a>* sdk):</div><div class="line">        mUbieSdk(sdk),</div><div class="line">        mMaintenanceThread(nullptr),</div><div class="line">        mMaintenanceThreadRunning(false),</div><div class="line">        mTestDevice(),</div><div class="line">        mTestOutput()</div><div class="line">{</div><div class="line">        <span class="keywordflow">if</span> (mUbieSdk)</div><div class="line">        {</div><div class="line">                LOG(<a class="code" href="namespaceSdkNs.html#a8ce0f25cba0e252e8ba2f2b578d77596a551b723eafd6a31d444fcb2f5920fbd3">INFO</a>) &lt;&lt; <span class="stringliteral">&quot;Main App object created&quot;</span>;</div><div class="line">                mUbieSdk-&gt;registerUbieSdkClient(<span class="keyword">this</span>);</div><div class="line"></div><div class="line">        <span class="comment">//Create my own device, that holds the Ubie device. My device now has ownership of the Ubie device object</span></div><div class="line">                <span class="comment">//The Id &#39;1&#39; must be unique accross all devices and functionblocks. You must supply the same id, across restarts of your application</span></div><div class="line">                <span class="keyword">auto</span> ubieDevice = mUbieSdk-&gt;functionBlockManager()-&gt;createDevice(<span class="stringliteral">&quot;myDeviceType&quot;</span>, <span class="stringliteral">&quot;1&quot;</span>);</div><div class="line">                mTestDevice = <span class="keyword">new</span> TestDevice(ubieDevice);</div><div class="line"></div><div class="line">                <span class="comment">// The Id &#39;2&#39;: same remark as above</span></div><div class="line">                mTestOutput = <span class="keyword">new</span> TestOutput(mUbieSdk-&gt;functionBlockManager()-&gt;createOnOff(ubieDevice, <span class="stringliteral">&quot;2&quot;</span>));</div><div class="line"></div><div class="line">                <span class="comment">//When all UbieDevices and Functionblocks are created; send the config to the cloud</span></div><div class="line">                mUbieSdk-&gt;functionBlockManager()-&gt;sendUbieConfig();</div><div class="line"></div><div class="line">                <span class="comment">//At startup, you must update the state of the functionblock, with the current state</span></div><div class="line">                <span class="comment">//When doing multiple state updates (ex: at startup). Commit the states in one message (beginStatusUpdate and commitStatusUpdate)</span></div><div class="line">                mUbieSdk-&gt;functionBlockManager()-&gt;beginStatusUpdate();</div><div class="line"></div><div class="line">                <span class="comment">//Set the initial states (as received from our own system)</span></div><div class="line">                mTestDevice-&gt;connected(<span class="keyword">true</span>);</div><div class="line">                mTestOutput-&gt;outputValue(<span class="keyword">false</span>);</div><div class="line"></div><div class="line">                <span class="comment">//Comit all states at once (=reduce network traffic)</span></div><div class="line">                mUbieSdk-&gt;functionBlockManager()-&gt;commitStatusUpdate();</div><div class="line"></div><div class="line">                <span class="comment">//Start a maintenance thread</span></div><div class="line">                startMaintenanceThread();</div><div class="line">        }</div><div class="line">}</div></div><!-- fragment --><p>The first line starts with registering a receiver for generic Sdk messages (Upnp messages, receiving cloud configuration, etc...): </p><div class="fragment"><div class="line">mUbieSdk-&gt;registerUbieSdkClient(<span class="keyword">this</span>);</div></div><!-- fragment --><p> After that, you start creating devices and functionblocks.</p>
<h3>9.1 Static Ubie App Configuration</h3>
<p>Static configuration is the creation of one or more devices, with one or more functionblocks. When all devices and functionblocks are created, you call sendUbieConfig():</p>
<div class="fragment"><div class="line"><span class="comment">//Create my own device, that holds the Ubie device. My device now has ownership of the Ubie device object</span></div><div class="line">        <span class="comment">//The Id &#39;1&#39; must be unique accross all devices and functionblocks. You must supply the same id, across restarts of your application</span></div><div class="line">        <span class="keyword">auto</span> ubieDevice = mUbieSdk-&gt;functionBlockManager()-&gt;createDevice(<span class="stringliteral">&quot;myDeviceType&quot;</span>, <span class="stringliteral">&quot;1&quot;</span>);</div><div class="line">        mTestDevice = <span class="keyword">new</span> TestDevice(ubieDevice);</div><div class="line"></div><div class="line">        <span class="comment">// The Id &#39;2&#39;: same remark as above</span></div><div class="line">        mTestOutput = <span class="keyword">new</span> TestOutput(mUbieSdk-&gt;functionBlockManager()-&gt;createOnOff(ubieDevice, <span class="stringliteral">&quot;2&quot;</span>));</div><div class="line"></div><div class="line">        <span class="comment">//When all UbieDevices and Functionblocks are created; send the config to the cloud</span></div><div class="line">        mUbieSdk-&gt;functionBlockManager()-&gt;sendUbieConfig();</div></div><!-- fragment --><p>Devices and functionblocks need to have a unique ID (see "SdkDevID", "SdkFbId"). This ID needs to be consistent between restarts of the application and reboot of the Ubie. Is is therefore advisable to keep some kind of local configuration file to map a unique id (ex MAC address) to the device/functionblock Id. Devices have a number of configuration properties that can be set:</p>
<ul>
<li>serial</li>
<li>ip</li>
</ul>
<p>Functionblocks have a common set of configuration properties (besides their own set of specific properties):</p>
<ul>
<li>Generic<ul>
<li>name</li>
<li>location</li>
</ul>
</li>
<li>Functionblock specific<ul>
<li>OnOff<ul>
<li>valueConfig</li>
</ul>
</li>
<li>Analog<ul>
<li>valueConfig</li>
</ul>
</li>
<li>Termostat<ul>
<li>currRegimeConfig</li>
<li>currTempConfig</li>
<li>setTempConfig</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Each of there calls accepts a config structure. This structure contains the various config of the property. ex:</p>
<div class="fragment"><div class="line">boost::optional&lt;bool&gt; available;</div><div class="line">boost::optional&lt;bool&gt; readAllowed;</div><div class="line">boost::optional&lt;bool&gt; writeAllowed;</div><div class="line"></div><div class="line">boost::optional&lt;double&gt; min;</div><div class="line">boost::optional&lt;double&gt; max;</div><div class="line">boost::optional&lt;double&gt; step;</div><div class="line">boost::optional&lt;std::string&gt; unit;</div></div><!-- fragment --><p>After a change to any of the configuration properties, you need to call sendUbieConfig().</p>
<h3>9.2 Dynamic State</h3>
<div class="image">
<img src="DynamicState.png" alt="DynamicState.png"/>
<div class="caption">
Dynamic State</div></div>
<p> The dynamic state of a functionblock is stored in values of the functionblock properties. Each device or functionblock has it own set of properties:</p><ul>
<li>NetworkDevice:<ul>
<li>connectable: Do we have all the information to connect to a device (ex login/password) ?</li>
<li>connected: Are we actually connected to the device ?</li>
</ul>
</li>
<li>FunctionBlock<ul>
<li>OnOff<ul>
<li>value: The On/Off value of a switch</li>
</ul>
</li>
<li>Dimmer<ul>
<li>value: The dimmer valu of a dimmer (0 .. 100%)</li>
</ul>
</li>
<li>Thermo<ul>
<li>currRegime: The current regime of an thermostat</li>
<li>currTemp: The current temperature of an thermostat</li>
<li>currTemp: The current set temperature of an thermostat</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Changing the value of a property can be done by calling the property function (ex <code>value(true)</code>) of a functionblock, followed by a call to <code>commit()</code>. When the Sdk detects a change in the value, then the value will be transmitted by calling <code>commit()</code>.</p>
<p>After the creation of a functionblock, you should set the initial state of all properties, and call <code>commit()</code> on the functionblock. Every commit causes a communication with the cloud. It is advised that many commits are grouped in a single communication with the cloud. This can be done by using the beginstatusupdate and commitStatusUpdate calls:</p>
<div class="fragment"><div class="line"><span class="comment">//This will group all commit messages in a single message to the cloud</span></div><div class="line">mUbieSdk-&gt;functionBlockManager()-&gt;beginStatusUpdate();</div><div class="line"></div><div class="line">mSwitch-&gt;value(0);</div><div class="line">mSwitch-&gt;commit();  <span class="comment">//No message will be send to the cloud</span></div><div class="line"></div><div class="line"><span class="comment">//Comit all states at once (=reduce network traffic)</span></div><div class="line">mUbieSdk-&gt;functionBlockManager()-&gt;commitStatusUpdate();</div></div><!-- fragment --><h3>9.3 State changes</h3>
<p>Property changes (from Cloud or Ubie Logic) will be send to the client interface of the functionblock. You can register a object that will receive the cloud values.</p>
<div class="fragment"><div class="line"><span class="comment">//Create a functionblock</span></div><div class="line">mSwitch = mUbieSdk-&gt;functionBlockManager()-&gt;createOnOff(mUbieDevice, <span class="stringliteral">&quot;SdkFbId&quot;</span>);</div><div class="line"></div><div class="line"><span class="comment">//Register a object that will receive updates for this functionblock (that implements the SdkNs::OnOffClientIf interface)</span></div><div class="line">mSwitch-&gt;registerClient(yourObjectThatWillReceiveMessages);</div></div><!-- fragment --><p>When 1 or more property's are changed, then all property value callbacks are called, followed by a single call to <code>commit(property set)</code>. The commit call contains a set with the names of all property's that where changed. This is the point when you know all the new property values, and where you can write these to your system.</p>
<p>The return value of the commit(property set) callback has a specific meaning. It informs the Sdk how long it needs to wait before sending the next state (if multiple states where send from the cloud). The following values are possible:</p>
<ul>
<li>-1: Do not wait before sending the next state</li>
<li>0: Use the default wait time (500 mseconds)</li>
<li>value &gt; 0: Wait "value" ms before sending the next state</li>
</ul>
<h3>9.4 Actions</h3>
<p>Certain function blocks can receive "actions". Actions can be seen as a function call on a functionblock/device, a request from the cloud to "do something" on the functionblock. An action can be accompanied with 0 or more properties. The sequence is almost the same as with properties. First you will receive 0 or more property changes on the callback interface, followed by the action callback (ex: <code>shutterDown</code>). The 'std::set&lt;std::string&gt;' parameter contains the set of properties that was accompanied with this call. The return value from the action callback has a specific meaning (just like the commit callback) The following values are possible:</p>
<ul>
<li>-1: Do not wait before sending the next state</li>
<li>0: Use the default wait time (500 mseconds)</li>
<li>value &gt; 0: Wait "value" ms before sending the next state</li>
</ul>
<h3>9.5 Logging</h3>
<p>Ubie Apps use google glog as logging system. Your application should use this to log any informational, debugging message to the application log (console or file). When your application runs on the Ubie then this log is written on disk.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;glog/logging.h&gt;</span></div><div class="line">LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;This message will be written to the console&quot;</span></div><div class="line">LOG(ERROR) &lt;&lt; <span class="stringliteral">&quot;This error message will always be written to the console&quot;</span></div><div class="line">VLOG(1) &lt;&lt; <span class="stringliteral">&quot;This message will only be written to the log when verbose level is 1 or higher&quot;</span></div></div><!-- fragment --><p> More information reagarding Google glog can be found in this <a href="http://rpg.ifi.uzh.ch/docs/glog.html">cheat sheet</a> .</p>
<h3>9.6 Messages</h3>
<p>The Sdk allows you to send messages to the end-user. This message system supports multiple languages. Translations need to be supplied by the developper. The messages, and translations are stored in a json file (messages.json). The language identifier follows the 639-1 code that can be found <a href="https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes">here</a> .</p>
<p>Messages can contain parameters that can be replaced by actual values in code (ex: <code>{0}</code>). The actual value of this replacement must always be a string. This is an example message file: </p><div class="fragment"><div class="line">{</div><div class="line">  &quot;TEST_NOPARAM&quot;: {</div><div class="line">    &quot;en&quot;: &quot;This is a test&quot;,</div><div class="line">    &quot;nl&quot;: &quot;Dit is een test&quot;</div><div class="line">  },</div><div class="line">  &quot;TEST_WITHPARAM&quot;: {</div><div class="line">    &quot;en&quot;: &quot;This is a test, first param: {0}&quot;,</div><div class="line">    &quot;nl&quot;: &quot;Dit is een test, eerste parameter: {0}&quot;</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p>Sending this message can be done on multiple levels:</p>
<ul>
<li>Sdk: generic messages regarding the application</li>
<li>Network device: messages concerning this network device</li>
<li>Function block: messages concerning this function block</li>
</ul>
<div class="fragment"><div class="line">mSdk.cloudMessage(<a class="code" href="namespaceSdkNs.html#a8ce0f25cba0e252e8ba2f2b578d77596a551b723eafd6a31d444fcb2f5920fbd3">SdkNs::SdkMessageLevel::INFO</a>, <span class="stringliteral">&quot;TEST_WITHPARAM&quot;</span>, {{0, <span class="stringliteral">&quot;First Value&quot;</span>}});</div></div><!-- fragment --><p>Replacing parameters is done via a <code>std::map&lt;int, std::string&gt;</code>, where the integer value corresponds with the integer value between the {} parentheses.</p>
<h3>9.7 Watchdog</h3>
<p>Creating the Sdk object already adds watchdog functionality to your application. When your application crashes, then it will be restarted. But you can add additional watchdog functionality to your application. If you have a function/thread that will wakeup each x seconds. Then you can add watchdog functionality to this function/thread by calling these functions:</p>
<ul>
<li>promise: Add a promise to the Sdk. You promise to call feed every timeoutMilliseconds (take some margin)</li>
<li>feed: feed the watchdog, before your promise timeout expires</li>
<li>removePromise: remove the promise; ex when your thread exists</li>
</ul>
<p>You should use the same "from" string for each of the above calls.</p>
<h2>10. UPnP</h2>
<p>UbieOS contains a Upnp application that continious searches for UPnP devices. When a new device is found, then you will receive a callbak on the <code>UbieSdkClientIf</code> interface as <code>uPnPDeviceFound</code>. When a device is lost then a call will be made to <code>uPnpDeviceLost</code>. When a application has rebooted, then you will first receive <code>uPnpDeviceLost</code>, followed by <code>uPnPDeviceFound</code>.</p>
<h2>11. Remove Device</h2>
<p>Users can delete devices on the cloud. This delete should be handled by your application. When you receive a "removeDevice" call, then you should delete the device from the Ubie configuration, and stop all communication with the device. If the device is still on the network, then you can still add it to the configuration, but you should set the connectable and connected properties to "false".</p>
<p>The result of the remove device should be send to the cloud via a call to <code>removeDeviceResult(const std::string&amp; devId, bool success)</code>. You should only do this if the devId is a device ID of your application. You should not reponse in any way if the devId is unknown to your application. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Sep 2 2021 14:36:09 for Ubie Sdk by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
